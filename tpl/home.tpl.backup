<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>TimeTracking - AppMobTimeTouch</title>
    
    <!-- OnsenUI CSS -->
    <link rel="stylesheet" href="css/onsenui.min.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="Assets/css/timeclock-base.css">
    <link rel="stylesheet" href="Assets/css/timeclock-components.css">
    <link rel="stylesheet" href="Assets/css/timeclock-responsive.css">
</head>
<body>

<ons-page id="ONSHome">
  <?php include "tpl/parts/topbar-home.tpl"; ?>
  
  <ons-pull-hook id="pull-hook">
    <?php echo $langs->trans("PullToRefresh"); ?>
  </ons-pull-hook>
  
  <!-- Messages d'erreur/succès -->
  <?php if (!empty($errors)): ?>
  <div style="padding: 10px 15px;">
    <?php foreach ($errors as $error_msg): ?>
    <ons-card style="background-color: #ffebee; border-left: 4px solid #f44336;">
      <div class="content" style="padding: 10px;">
        <ons-icon icon="md-warning" style="color: #f44336; margin-right: 8px;"></ons-icon>
        <span style="color: #c62828;"><?php echo dol_escape_htmltag($error_msg); ?></span>
      </div>
    </ons-card>
    <?php endforeach; ?>
  </div>
  <?php endif; ?>

  <?php if (!empty($messages)): ?>
  <div style="padding: 10px 15px;">
    <?php foreach ($messages as $msg): ?>
    <ons-card style="background-color: #e8f5e8; border-left: 4px solid #4CAF50;">
      <div class="content" style="padding: 10px;">
        <ons-icon icon="md-check-circle" style="color: #4CAF50; margin-right: 8px;"></ons-icon>
        <span style="color: #2e7d32;"><?php echo dol_escape_htmltag($msg); ?></span>
      </div>
    </ons-card>
    <?php endforeach; ?>
  </div>
  <?php endif; ?>
  
  <!-- Status Card -->
  <div style="padding: 15px;">
    <ons-card>
      <div class="title" style="text-align: center; padding: 10px 0;">
        <h2><?php echo $langs->trans("TimeclockStatus"); ?></h2>
      </div>
      
      <div class="content" style="text-align: center; padding: 20px;">
        <?php if ($is_clocked_in): ?>
          <!-- User is clocked in -->
          <div class="timeclock-status-active">
            <ons-icon icon="md-time" size="48px" style="color: #4CAF50; animation: pulse 2s infinite;"></ons-icon>
            <h3 style="color: #4CAF50; margin: 10px 0;">
              <?php echo $langs->trans("ClockedIn"); ?>
            </h3>
            <p style="margin: 5px 0;">
              <strong><?php echo $langs->trans("Since"); ?>:</strong> 
              <?php echo dol_print_date($clock_in_time, 'dayhour', 'tzuser'); ?>  
            </p>
            <p style="margin: 5px 0;">
              <strong><?php echo $langs->trans("Duration"); ?>:</strong>
              <span id="current-duration" style="font-weight: bold; color: #4CAF50;">
                <?php echo TimeHelper::convertSecondsToReadableTime($current_duration); ?>
              </span>
            </p>
            <?php if ($active_record && !empty($active_record->fk_timeclock_type)): ?>
              <?php
              $type = new TimeclockType($db);
              $type->fetch($active_record->fk_timeclock_type);
              ?>
              <p style="margin: 5px 0;">
                <strong><?php echo $langs->trans("Type"); ?>:</strong>
                <span style="background-color: <?php echo $type->color; ?>; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                  <?php echo $type->label; ?>
                </span>
              </p>
            <?php endif; ?>
            
            <?php if ($active_record && !empty($active_record->location_in)): ?>
            <p style="margin: 5px 0; font-size: 12px; color: #666;">
              <ons-icon icon="md-place" style="color: #666;"></ons-icon>
              <?php echo dol_escape_htmltag($active_record->location_in); ?>
            </p>
            <?php endif; ?>
            
            <!-- Alerte heures supplémentaires -->
            <?php if ($overtime_alert): ?>
            <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 10px; margin-top: 15px;">
              <ons-icon icon="md-warning" style="color: #ffc107;"></ons-icon>
              <span style="color: #856404; font-size: 14px; margin-left: 5px;">
                <strong><?php echo $langs->trans("OvertimeAlert"); ?></strong>
              </span>
            </div>
            <?php endif; ?>
          </div>
          
          <!-- Clock Out Button -->
          <div style="margin-top: 20px;">
            <ons-button modifier="large" onclick="showClockOutModal()" style="background-color: #f44336; color: white; width: 100%; border-radius: 25px; font-size: 16px;">
              <ons-icon icon="md-stop" style="margin-right: 10px;"></ons-icon>
              <?php echo $langs->trans("ClockOut"); ?>
            </ons-button>
          </div>
          
        <?php else: ?>
          <!-- User is not clocked in -->
          <div class="timeclock-status-inactive">
            <ons-icon icon="md-pause-circle-outline" size="48px" style="color: #999;"></ons-icon>
            <h3 style="color: #999; margin: 10px 0;">
              <?php echo $langs->trans("NotClockedIn"); ?>
            </h3>
            <p style="color: #666; margin: 10px 0;">
              <?php echo $langs->trans("ReadyToStart"); ?>
            </p>
          </div>
          
          <!-- Clock In Button -->
          <div style="margin-top: 20px;">
            <ons-button modifier="large" onclick="showClockInModal()" style="background-color: #4CAF50; color: white; width: 100%; border-radius: 25px; font-size: 16px;">
              <ons-icon icon="md-play-arrow" style="margin-right: 10px;"></ons-icon>
              <?php echo $langs->trans("ClockIn"); ?>
            </ons-button>
          </div>
          
        <?php endif; ?>
      </div>
    </ons-card>
  </div>
  
  <!-- Today's Summary -->
  <div style="padding: 0 15px 15px 15px;">
    <ons-card>
      <div class="title" style="padding: 10px;">
        <h3><?php echo $langs->trans("TodaySummary"); ?></h3>
      </div>
      <div class="content" style="padding: 0 15px 15px 15px;">
        <ons-row>
          <ons-col width="50%">
            <div style="text-align: center; padding: 10px;">
              <ons-icon icon="md-access-time" style="color: #2196F3; font-size: 24px;"></ons-icon>
              <p style="margin: 5px 0; font-size: 14px; color: #666;">
                <?php echo $langs->trans("WorkedHours"); ?>
              </p>
              <p style="margin: 0; font-size: 18px; font-weight: bold; color: #2196F3;">
                <?php echo TimeHelper::convertSecondsToReadableTime($today_total_hours * 3600); ?>
              </p>
            </div>
          </ons-col>
          <ons-col width="50%">

            <!-- <div style="text-align: center; padding: 10px;">
              <ons-icon icon="md-pause" style="color: #FF9800; font-size: 24px;"></ons-icon>
              <p style="margin: 5px 0; font-size: 14px; color: #666;">
                <?php echo $langs->trans("BreakTime"); ?>
              </p>
              <p style="margin: 0; font-size: 18px; font-weight: bold; color: #FF9800;">
                <?php echo TimeHelper::convertSecondsToReadableTime($today_total_breaks * 60); ?>
              </p>
            </div> -->

          </ons-col>
        </ons-row>
        
        <!-- Progress bar for daily target -->
        <div style="margin-top: 15px;">
          <?php 
          $daily_progress = min(100, ($today_total_hours / $overtime_threshold) * 100);
          $progress_color = $daily_progress > 100 ? '#f44336' : ($daily_progress > 80 ? '#FF9800' : '#4CAF50');
          ?>
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span style="font-size: 12px; color: #666;"><?php echo $langs->trans("DailyTarget"); ?></span>
            <span style="font-size: 12px; color: #666;"><?php echo round($daily_progress, 1); ?>%</span>
          </div>
          <div style="background-color: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
            <div style="background-color: <?php echo $progress_color; ?>; height: 100%; width: <?php echo min(100, $daily_progress); ?>%; transition: width 0.3s ease;"></div>
          </div>
        </div>
      </div>
    </ons-card>
  </div>
  
  <!-- Weekly Summary -->
  <?php if ($weekly_summary): ?>
  <div style="padding: 0 15px 15px 15px;">
    <ons-card>
      <div class="title" style="padding: 10px;">
        <h3><?php echo $langs->trans("WeekSummary"); ?> - <?php echo $langs->trans("Week"); ?> <?php echo $weekly_summary->week_number; ?></h3>
      </div>
      <div class="content" style="padding: 0 15px 15px 15px;">
        <ons-row>
          <ons-col width="33%">
            <div style="text-align: center; padding: 10px;">
              <p style="margin: 5px 0; font-size: 12px; color: #666;">
                <?php echo $langs->trans("TotalHours"); ?>
              </p>
              <p style="margin: 0; font-size: 16px; font-weight: bold;">
                <?php echo TimeHelper::convertSecondsToReadableTime($weekly_summary->total_hours * 3600); ?>
              </p>
            </div>
          </ons-col>
          <ons-col width="33%">
            <div style="text-align: center; padding: 10px;">
              <p style="margin: 5px 0; font-size: 12px; color: #666;">
                <?php echo $langs->trans("DaysWorked"); ?>
              </p>
              <p style="margin: 0; font-size: 16px; font-weight: bold;">
                <?php echo $weekly_summary->days_worked; ?>
              </p>
            </div>
          </ons-col>
          <ons-col width="33%">
            <div style="text-align: center; padding: 10px;">
              <p style="margin: 5px 0; font-size: 12px; color: #666;">
                <?php echo $langs->trans("Status"); ?>
              </p>
              <div style="margin: 0;">
                <?php echo $weekly_summary->getLibStatut(3); ?>
              </div>
            </div>
          </ons-col>
        </ons-row>
        
        <?php if ($weekly_summary->overtime_hours > 0): ?>
        <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin-top: 10px;">
          <p style="margin: 0; color: #856404; font-size: 14px;">
            <ons-icon icon="md-warning" style="color: #ffc107;"></ons-icon>
            <strong><?php echo $langs->trans("OvertimeHours"); ?>:</strong>
            <?php echo TimeHelper::convertSecondsToReadableTime($weekly_summary->overtime_hours * 3600); ?>
          </p>
        </div>
        <?php endif; ?>
        
        <!-- Weekly progress -->
        <?php 
        $weekly_progress = min(100, ($weekly_summary->total_hours / $weekly_summary->expected_hours) * 100);
        $weekly_color = $weekly_progress > 100 ? '#f44336' : ($weekly_progress > 80 ? '#FF9800' : '#4CAF50');
        ?>
        <div style="margin-top: 15px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span style="font-size: 12px; color: #666;"><?php echo $langs->trans("WeeklyTarget"); ?></span>
            <span style="font-size: 12px; color: #666;"><?php echo round($weekly_progress, 1); ?>%</span>
          </div>
          <div style="background-color: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
            <div style="background-color: <?php echo $weekly_color; ?>; height: 100%; width: <?php echo min(100, $weekly_progress); ?>%; transition: width 0.3s ease;"></div>
          </div>
        </div>
      </div>
    </ons-card>
  </div>
  <?php endif; ?>
  
  <!-- Recent Records -->
  <?php if (!empty($recent_records)): ?>
  <div style="padding: 0 15px 15px 15px;">
    <ons-card>
      <div class="title" style="padding: 10px;">
        <h3><?php echo $langs->trans("RecentRecords"); ?></h3>
      </div>
      <ons-list style="margin: 0;">
        <?php 
        $count = 0;
        foreach ($recent_records as $record): 
          if ($count >= 5) break; // Limit to 5 records
          $count++;
          
          // Get type info
          $type = new TimeclockType($db);
          $type->fetch($record->fk_timeclock_type);
          
          $record_date = dol_print_date($db->jdate($record->clock_in_time), 'day');
          $clock_in = dol_print_date($db->jdate($record->clock_in_time), 'hour');
          $clock_out = !empty($record->clock_out_time) ? dol_print_date($db->jdate($record->clock_out_time), 'hour') : '';
          $duration = !empty($record->work_duration) ? TimeHelper::convertSecondsToReadableTime($record->work_duration * 60) : '';
          $status_class = '';
          
          switch ($record->status) {
            case 2: // In progress
              $status_class = 'status-active';
              break;
            case 3: // Completed
              $status_class = 'status-completed';
              break;
            default:
              $status_class = 'status-draft';
          }
        ?>
        <ons-list-item tappable onclick="viewRecord(<?php echo $record->id; ?>)">
          <div class="left">
            <div style="width: 8px; height: 40px; background-color: <?php echo $type->color; ?>; border-radius: 4px;"></div>
          </div>
          <div class="center">
            <div style="font-weight: bold; margin-bottom: 2px;">
              <?php echo $record_date; ?>
            </div>
            <div style="font-size: 14px; color: #666; margin-bottom: 2px;">
              <span style="background-color: <?php echo $type->color; ?>; color: white; padding: 2px 6px; border-radius: 8px; font-size: 11px;">
              <?php echo $type->label; ?>
              </span>
            </div>
            <div style="font-size: 12px; color: #999;">
              <?php echo $clock_in; ?>
              <?php if ($clock_out): ?>
                - <?php echo $clock_out; ?>
              <?php endif; ?>
              <div style="margin-top: 2px;">
                <?php echo $record->getLibStatut(5); ?>
              </div>
            </div>
          </div>
          <div class="right">
            <?php if ($duration): ?>
              <div style="font-weight: bold; color: #4CAF50;">
                <?php echo $duration; ?>
              </div>
            <?php else: ?>
              <ons-icon icon="md-more-vert" style="color: #999;"></ons-icon>
            <?php endif; ?>
          </div>
        </ons-list-item>
        <?php endforeach; ?>
      </ons-list>
      
      <?php if (count($recent_records) > 5): ?>
      <div style="text-align: center; padding: 10px;">
        <ons-button modifier="quiet" onclick="gotoPage('myTimeclockRecords');">
          <?php echo $langs->trans("ViewAllRecords"); ?>
        </ons-button>
      </div>
      <?php endif; ?>
    </ons-card>
  </div>
  <?php endif; ?>

  <!-- Clock In Modal -->
  <ons-modal var="clockInModal" id="clockInModal">
    <div style="background-color: white; border-radius: 8px; margin: 20px; max-height: 90vh; overflow-y: auto;">
      <!-- Header du modal -->
      <div style="background: linear-gradient(45deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 8px 8px 0 0; text-align: center;">
        <ons-icon icon="md-play-arrow" size="24px" style="margin-right: 10px;"></ons-icon>
        <h3 style="margin: 0; font-size: 18px;"><?php echo $langs->trans("ClockIn"); ?></h3>
      </div>
      
      <div style="padding: 20px;">
        <form id="clockInForm" method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
          <input type="hidden" name="action" value="clockin">
          <input type="hidden" name="token" value="<?php echo newToken(); ?>">
          <input type="hidden" name="latitude" id="clockin_latitude">
          <input type="hidden" name="longitude" id="clockin_longitude">
          <input type="hidden" name="timeclock_type_id" id="selected_timeclock_type" value="<?php echo $default_type_id; ?>">
          
          <!-- Sélection du type de pointage avec OnsenUI -->
          <div style="margin-bottom: 20px;">
            <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
              <ons-icon icon="md-work" style="color: #4CAF50; margin-right: 8px;"></ons-icon>
              <?php echo $langs->trans("TimeclockType")."AAA"; ?>:
            </div>
            
            <ons-list id="timeclockTypeList" style="border: 1px solid #e0e0e0; border-radius: 6px; margin: 0;">
              <?php foreach ($timeclock_types as $type): ?>
              <ons-list-item 
                tappable 
                class="timeclock-type-item <?php echo ($type->id == $default_type_id) ? 'selected' : ''; ?>"
                data-type-id="<?php echo $type->id; ?>"
                onclick="selectTimeclockType(<?php echo $type->id; ?>, '<?php echo dol_escape_js($type->label); ?>', '<?php echo $type->color; ?>')"
                style="border-bottom: 1px solid #f0f0f0; transition: all 0.3s ease;">
                
                <div class="left" style="width: 50px;">
                  <div style="width: 20px; height: 20px; background-color: <?php echo $type->color; ?>; border-radius: 50%; margin: auto; border: 2px solid rgba(255,255,255,0.8); box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                </div>
                
                <div class="center">
                  <div style="font-weight: 500; color: #333; font-size: 16px;">
                    <?php echo $type->label; ?>
                  </div>
                  <div style="font-size: 12px; color: #666; margin-top: 2px;">
                    <?php echo $type->code; ?>
                  </div>
                </div>
                
                <div class="right">
                  <ons-icon 
                    icon="md-check-circle" 
                    class="type-selected-icon" 
                    style="color: #4CAF50; font-size: 20px; display: <?php echo ($type->id == $default_type_id) ? 'block' : 'none'; ?>;">
                  </ons-icon>
                </div>
              </ons-list-item>
              <?php endforeach; ?>
            </ons-list>
          </div>
          
          <!-- Localisation -->
          <div style="margin-bottom: 20px;">
            <div style="font-weight: bold; margin-bottom: 8px; color: #333;">
              <ons-icon icon="md-place" style="color: #FF9800; margin-right: 8px;"></ons-icon>
              <?php echo $langs->trans("Location"); ?>:
            </div>
            <input 
              type="text" 
              name="location" 
              id="clockin_location" 
              placeholder="<?php echo $langs->trans("EnterLocation"); ?>" 
              style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; background: #f9f9f9;"
              onfocus="this.style.borderColor='#4CAF50'; this.style.background='white';"
              onblur="this.style.borderColor='#ddd'; this.style.background='#f9f9f9';">
          </div>
          
          <!-- Note -->
          <div style="margin-bottom: 20px;">
            <div style="font-weight: bold; margin-bottom: 8px; color: #333;">
              <ons-icon icon="md-note" style="color: #2196F3; margin-right: 8px;"></ons-icon>
              <?php echo $langs->trans("Note"); ?>:
            </div>
            <textarea 
              name="note" 
              placeholder="<?php echo $langs->trans("OptionalNote"); ?>" 
              style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; height: 80px; resize: vertical; font-size: 16px; font-family: inherit; background: #f9f9f9;"
              onfocus="this.style.borderColor='#4CAF50'; this.style.background='white';"
              onblur="this.style.borderColor='#ddd'; this.style.background='#f9f9f9';"></textarea>
          </div>
          
          <!-- Statut GPS -->
          <div id="gps-status" style="margin-bottom: 20px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 14px; color: #666; text-align: center; min-height: 20px;">
            <ons-icon icon="md-gps-fixed" style="color: #666; margin-right: 5px;"></ons-icon>
            <span id="gps-status-text"><?php echo $langs->trans("ReadyToStart"); ?></span>
          </div>
          
          <!-- Boutons d'action -->
          <div style="display: flex; gap: 10px; margin-top: 25px;">
            <ons-button 
              onclick="clockInModal.hide()" 
              style="flex: 1; background: #f5f5f5; color: #666; border: 1px solid #ddd; border-radius: 25px; padding: 12px; font-size: 16px; font-weight: 500;">
              <ons-icon icon="md-close" style="margin-right: 8px;"></ons-icon>
              <?php echo $langs->trans("Cancel"); ?>
            </ons-button>
            
            <ons-button 
              onclick="submitClockIn()" 
              style="flex: 2; background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; border-radius: 25px; padding: 12px; font-size: 16px; font-weight: 500; box-shadow: 0 3px 6px rgba(76, 175, 80, 0.3);">
              <ons-icon icon="md-play-arrow" style="margin-right: 8px;"></ons-icon>
              <?php echo $langs->trans("ClockIn"); ?>
            </ons-button>
          </div>
        </form>
      </div>
    </div>
  </ons-modal>

<!-- Clock Out Modal -->
<ons-modal var="clockOutModal" id="clockOutModal">
  <div style="background-color: white; border-radius: 8px; margin: 20px; max-height: 90vh; overflow-y: auto;">
    <!-- Header du modal -->
    <div style="background: linear-gradient(45deg, #f44336, #d32f2f); color: white; padding: 20px; border-radius: 8px 8px 0 0; text-align: center;">
      <ons-icon icon="md-stop" size="24px" style="margin-right: 10px;"></ons-icon>
      <h3 style="margin: 0; font-size: 18px;"><?php echo $langs->trans("ClockOut"); ?></h3>
    </div>
    
    <div style="padding: 20px;">
      <!-- Résumé de la session en cours -->
      <?php if ($is_clocked_in && $active_record): ?>
      <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
        <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px; display: flex; align-items: center;">
          <ons-icon icon="md-access-time" style="margin-right: 8px;"></ons-icon>
          <?php echo $langs->trans("SessionSummary"); ?>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
          <div style="flex: 1; min-width: 120px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 2px;"><?php echo $langs->trans("Since"); ?></div>
            <div style="font-weight: 500; color: #333;"><?php echo dol_print_date($clock_in_time, 'hour', 'tzuser'); ?></div>
          </div>
          

          <div style="flex: 1; min-width: 120px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 2px;"><?php echo $langs->trans("Duration"); ?></div>
            <div style="font-weight: bold; color: #4CAF50; font-size: 16px;" id="session-duration">
              <?php echo TimeHelper::convertSecondsToReadableTime($current_duration); ?>
            </div>
          </div>
          
          <?php if ($active_record && !empty($active_record->fk_timeclock_type)): ?>
            <?php
            $type = new TimeclockType($db);
            $type->fetch($active_record->fk_timeclock_type);
            ?>
          <div style="flex: 1; min-width: 120px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 2px;"><?php echo $langs->trans("Type"); ?></div>
            <div style="display: flex; align-items: center;">
              <div style="width: 12px; height: 12px; background-color: <?php echo $type->color; ?>; border-radius: 50%; margin-right: 6px;"></div>
              <span style="font-size: 14px; color: #333;"><?php echo $type->label; ?></span>
            </div>
          </div>
          <?php endif; ?>
        </div>
      </div>
      <?php endif; ?>
      
      <form id="clockOutForm" method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <input type="hidden" name="action" value="clockout">
        <input type="hidden" name="token" value="<?php echo newToken(); ?>">
        <input type="hidden" name="latitude" id="clockout_latitude">
        <input type="hidden" name="longitude" id="clockout_longitude">
        
        <!-- Boutons d'action -->
        <div style="display: flex; gap: 10px; margin-top: 25px;">
          <ons-button 
            onclick="clockOutModal.hide()" 
            style="flex: 1; background: #f5f5f5; color: #666; border: 1px solid #ddd; border-radius: 25px; padding: 12px; font-size: 16px; font-weight: 500;">
            <ons-icon icon="md-close" style="margin-right: 8px;"></ons-icon>
            <?php echo $langs->trans("Cancel"); ?>
          </ons-button>
          
          <ons-button 
            onclick="confirmClockOut()" 
            style="flex: 2; background: linear-gradient(45deg, #f44336, #d32f2f); color: white; border: none; border-radius: 25px; padding: 12px; font-size: 16px; font-weight: 500; box-shadow: 0 3px 6px rgba(244, 67, 54, 0.3);">
            <ons-icon icon="md-stop" style="margin-right: 8px;"></ons-icon>
            <?php echo $langs->trans("ClockOut"); ?>
          </ons-button>
        </div>

        <!-- Localisation de sortie -->
        <div style="margin-bottom: 20px; margin-top: 25px;">
          <div style="font-weight: bold; margin-bottom: 8px; color: #333;">
            <ons-icon icon="md-place" style="color: #FF9800; margin-right: 8px;"></ons-icon>
            <?php echo $langs->trans("Location"); ?>:
          </div>
          <input 
            type="text" 
            name="location" 
            id="clockout_location" 
            placeholder="<?php echo $langs->trans("EnterLocation"); ?>" 
            style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; background: #f9f9f9;"
            onfocus="this.style.borderColor='#f44336'; this.style.background='white';"
            onblur="this.style.borderColor='#ddd'; this.style.background='#f9f9f9';">
        </div>
        
        <!-- Note de fin de session -->
        <div style="margin-bottom: 20px;">
          <div style="font-weight: bold; margin-bottom: 8px; color: #333;">
            <ons-icon icon="md-note" style="color: #2196F3; margin-right: 8px;"></ons-icon>
            <?php echo $langs->trans("Note"); ?>:
          </div>
          <textarea 
            name="note" 
            id="clockout_note"
            placeholder="<?php echo $langs->trans("OptionalNote"); ?>" 
            style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; height: 80px; resize: vertical; font-size: 16px; font-family: inherit; background: #f9f9f9;"
            onfocus="this.style.borderColor='#f44336'; this.style.background='white';"
            onblur="this.style.borderColor='#ddd'; this.style.background='#f9f9f9';"></textarea>
        </div>
        
        <!-- Statut GPS -->
        <div id="gps-status-out" style="margin-bottom: 20px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 14px; color: #666; text-align: center; min-height: 20px;">
          <ons-icon icon="md-gps-fixed" style="color: #666; margin-right: 5px;"></ons-icon>
          <span id="gps-status-out-text"><?php echo $langs->trans("ReadyToClockOut"); ?></span>
        </div>
        

      </form>
    </div>
  </div>
</ons-modal>
  
  <!-- OnsenUI JS -->
  <script src="js/onsenui.min.js"></script>
  
  <!-- TimeClock API -->
  <script src="js/timeclock-api.js?v=<?php echo $js_data['version'] ?? '1.0'; ?>"></script>
  
  <!-- Custom JS Modules -->
  <script src="Assets/js/timeclock-app.js"></script>
  <script src="Assets/js/location-manager.js"></script>
  <script src="Assets/js/ui-components.js"></script>
  
  <script type="text/javascript">
    var appConfig = <?php echo json_encode($js_data); ?>;
  </script>
</ons-page>

</body>
</html>