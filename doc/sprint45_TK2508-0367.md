# Sprint 4.5 - TK2508-0367 : AccÃ¨s employÃ© Ã  la section "Liste des utilisateurs et leurs heures"

## ğŸ¯ Objectif
Permettre aux employÃ©s de visualiser la section "<!-- Liste des utilisateurs et leurs heures -->" dans les rapports, mais filtrÃ©e uniquement sur leur propre code utilisateur ou ID.

## ğŸ“‹ Ã‰tat actuel
- Les employÃ©s n'ont pas accÃ¨s Ã  la section "Liste des utilisateurs et leurs heures" dans les rapports
- La section est masquÃ©e par la condition `!$is_personal_view` dans les templates
- Les employÃ©s ne voient que les statistiques rÃ©sumÃ©es de leurs propres donnÃ©es

## ğŸ¯ RÃ©sultat attendu
- L'employÃ© peut visualiser la section "Liste des utilisateurs et leurs heures"
- Cette section ne contient que ses propres donnÃ©es (filtrage par user ID)
- L'interface reste cohÃ©rente avec la vue manager mais limitÃ©e Ã  une seule ligne
- Conservation de toutes les colonnes d'information (heures travaillÃ©es, thÃ©oriques, delta, etc.)

## ğŸ—ï¸ Plan de dÃ©veloppement MVP

### ğŸ“Š DÃ©coupage en MVPs testables

#### **MVP 1 : Modification de la logique de filtrage dans reports.php**
- **FonctionnalitÃ© core** : 
  - Adapter la logique `$is_personal_view` pour permettre l'accÃ¨s Ã  la section utilisateurs
  - CrÃ©er une nouvelle variable `$show_user_list` pour contrÃ´ler l'affichage de la section
  - Maintenir le filtrage des donnÃ©es par user ID pour les employÃ©s
- **Interface graphique** : Aucun changement visuel (logique back-end uniquement)
- **CritÃ¨res de validation** : 
  - Les employÃ©s peuvent accÃ©der Ã  reports.php sans erreurs
  - La variable `$show_user_list` est correctement dÃ©finie selon les droits utilisateur
  - Les donnÃ©es restent filtrÃ©es sur l'employÃ© connectÃ©

#### **MVP 2 : Adaptation du template monthly.tpl**
- **FonctionnalitÃ© core** :
  - Remplacer la condition `!$is_personal_view` par `$show_user_list` 
  - Adapter l'affichage pour une interface cohÃ©rente (une ligne utilisateur)
  - Conserver tous les Ã©lÃ©ments d'information (colonnes heures, delta, statut)
- **Interface graphique** :
  - Section "Liste des utilisateurs et leurs heures" visible pour l'employÃ©
  - Interface identique Ã  la vue manager mais avec une seule ligne
  - Titre adaptÃ© : "Mes heures dÃ©taillÃ©es" au lieu de "Liste des utilisateurs"
- **CritÃ¨res de validation** :
  - L'employÃ© voit ses heures mensuelles dans le format tableau standard
  - Toutes les colonnes sont prÃ©sentes et correctement formatÃ©es
  - Pas de donnÃ©es d'autres utilisateurs affichÃ©es

#### **MVP 3 : Adaptation du template annual.tpl**
- **FonctionnalitÃ© core** :
  - MÃªme adaptation que monthly.tpl pour les rapports annuels
  - CohÃ©rence entre rapports mensuels et annuels
- **Interface graphique** :
  - Section utilisateurs annuelle visible avec donnÃ©es personnelles
  - Interface cohÃ©rente avec monthly.tpl
- **CritÃ¨res de validation** :
  - L'employÃ© voit ses heures annuelles avec la mÃªme interface
  - CohÃ©rence parfaite entre vues mensuelle et annuelle
  - Informations YTD correctement affichÃ©es

## ğŸ“ Fichiers impactÃ©s

### Modifications principales
- `reports.php` : Logique de contrÃ´le d'affichage de la section utilisateurs
- `Views/reports/monthly.tpl` : Adaptation condition d'affichage et titre
- `Views/reports/annual.tpl` : Adaptation condition d'affichage et titre

### Variables ajoutÃ©es
- `$show_user_list` : BoolÃ©en pour contrÃ´ler l'affichage de la section utilisateurs
- Adaptation du titre dynamique selon le profil utilisateur

## ğŸ§ª Tests et validations

### Points de contrÃ´le MVP
- **AprÃ¨s MVP 1** : 
  - `reports.php` s'exÃ©cute sans erreur pour les employÃ©s
  - Variable `$show_user_list` correctement dÃ©finie
  - DonnÃ©es toujours filtrÃ©es par user ID

- **AprÃ¨s MVP 2** : 
  - Section "Liste des utilisateurs" visible en vue employÃ© mensuelle
  - Une seule ligne affichÃ©e (l'employÃ© connectÃ©)
  - Toutes les colonnes prÃ©sentes avec donnÃ©es correctes

- **AprÃ¨s MVP 3** : 
  - CohÃ©rence parfaite entre rapports mensuels et annuels
  - Interface employÃ© complÃ¨te et fonctionnelle
  - Aucune rÃ©gression sur la vue manager

### Validation interface utilisateur
- **Ã‰lÃ©ments visuels** : Section utilisateurs avec tableau une ligne
- **Interactions** : Navigation fluide, filtres fonctionnels
- **Feedback** : Titres adaptÃ©s selon le profil utilisateur
- **Ã‰tat** : Section complÃ¨tement opÃ©rationnelle pour employÃ©s et managers

## ğŸ”’ SÃ©curitÃ© et permissions

### ContrÃ´les maintenus
- Filtrage strict par user ID pour les employÃ©s
- Pas d'accÃ¨s aux donnÃ©es d'autres utilisateurs
- Respect des permissions Dolibarr existantes
- Conservation de la logique de droits `timeclock.export`

### Architecture respectÃ©e
- Principes SOLID maintenus
- Logique de filtrage centralisÃ©e dans `reports.php`
- Templates responsables uniquement de l'affichage
- Pas de duplication de code

## ğŸ“ˆ CritÃ¨res de succÃ¨s

### Fonctionnel
- âœ… L'employÃ© voit la section "Liste des utilisateurs et leurs heures"
- âœ… Seules ses propres donnÃ©es sont affichÃ©es
- âœ… Toutes les informations sont prÃ©sentes (heures, delta, statut, etc.)
- âœ… Interface cohÃ©rente entre rapports mensuels et annuels

### Technique
- âœ… Aucune rÃ©gression sur la vue manager
- âœ… Code respectant les principes MVP et SOLID
- âœ… SÃ©curitÃ© des donnÃ©es prÃ©servÃ©e
- âœ… Performance maintenue

### Utilisateur
- âœ… Interface intuitive et claire
- âœ… Informations facilement lisibles
- âœ… Navigation cohÃ©rente avec le reste de l'application
- âœ… Pas de confusion entre vue employÃ© et manager

---

**Statut** : ğŸ—ï¸ En cours d'implÃ©mentation
**AssignÃ©** : Claude Code
**Date crÃ©ation** : 2025-08-22
**PrioritÃ©** : Normale

## ğŸ“ Notes d'implÃ©mentation

### Respect des principes obligatoires
- âœ… Standard Dolibarr respectÃ©
- âœ… Pas de modification du core Dolibarr
- âœ… RÃ©utilisation des fonctions existantes
- âœ… Code basÃ© sur l'existant, pas d'hallucination
- âœ… Approche MVP avec Ã©tapes testables

### Validation dÃ©veloppement
1. "Cette modification respecte-t-elle les 5 principes ?" â†’ **OUI**
2. "L'architecture reste-t-elle maintenable et extensible ?" â†’ **OUI**
3. "Ce MVP apporte-t-il une valeur concrÃ¨te testable ?" â†’ **OUI**
4. "L'interface permet-elle de valider la fonctionnalitÃ© ?" â†’ **OUI**
5. "L'utilisateur peut-il comprendre et tester cette Ã©tape ?" â†’ **OUI**
6. "Les fonctionnalitÃ©s existantes restent-elles intactes ?" â†’ **OUI**
7. "L'application est-elle stable aprÃ¨s cette Ã©tape ?" â†’ **OUI**

### Prochaines Ã©tapes
1. ImplÃ©mentation MVP 1 : Modification `reports.php`
2. Validation et test MVP 1
3. Attendre validation utilisateur avant MVP 2